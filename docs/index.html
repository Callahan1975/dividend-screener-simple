<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dividend Screener – Quick View</title>

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      margin: 20px;
    }

    h1 {
      margin-bottom: 10px;
    }

    table.dataTable thead th {
      white-space: nowrap;
    }

    /* Signal badges */
    .signal-GOLD   { color: #b8860b; font-weight: 700; }
    .signal-BUY    { color: #0b6efd; font-weight: 700; }
    .signal-HOLD   { color: #555; }
    .signal-WATCH  { color: #999; }

    /* Confidence */
    .conf-High { color: #198754; font-weight: 600; }
    .conf-Med  { color: #fd7e14; font-weight: 600; }
    .conf-Low  { color: #dc3545; font-weight: 600; }

    /* Compact table */
    table.dataTable tbody td {
      padding: 6px 8px;
    }
  </style>
</head>

<body>

<h1>Dividend Screener – Quick Decision View</h1>
<p>Sorted by <b>Signal → Score → Confidence</b></p>

<table id="screener" class="display compact" style="width:100%">
  <thead>
    <tr>
      <th>Ticker</th>
      <th>Price</th>
      <th>Yield</th>
      <th>Upside</th>
      <th>Score</th>
      <th>Signal</th>
      <th>Conf</th>
      <th>Why</th>
    </tr>
  </thead>
</table>

<!-- jQuery + DataTables -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>

<!-- PapaParse for CSV -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
const CSV_PATH = "../data/screener_results.csv";

/* ---------- Custom sort for Signal ---------- */
const signalOrder = { "GOLD": 1, "BUY": 2, "HOLD": 3, "WATCH": 4 };
$.fn.dataTable.ext.type.order["signal-pre"] = function (d) {
  return signalOrder[d] || 99;
};

/* ---------- Load CSV ---------- */
Papa.parse(CSV_PATH, {
  download: true,
  header: true,
  dynamicTyping: true,
  complete: function (results) {

    const rows = results.data.filter(r => r.Ticker); // safety

    $("#screener").DataTable({
      data: rows,

      columns: [
        { data: "Ticker" },

        { data: "Price",
          render: d => d == null || d === "" ? "" : d.toFixed(2)
        },

        { data: "Yield_TTM_%",
          render: d => d == null || d === "" ? "" : d.toFixed(2) + "%"
        },

        { data: "Upside_%",
          render: d => d == null || d === "" ? "" : d.toFixed(1) + "%"
        },

        { data: "Score",
          render: d => d == null || d === "" ? "" : Math.round(d)
        },

        { data: "Signal",
          type: "signal",
          render: d => `<span class="signal-${d}">${d}</span>`
        },

        { data: "Confidence",
          render: d => `<span class="conf-${d}">${d}</span>`
        },

        { data: "Why" }
      ],

      order: [
        [5, "asc"],   // Signal
        [4, "desc"],  // Score
        [6, "asc"]    // Confidence
      ],

      pageLength: 50,
      deferRender: true,
      autoWidth: false
    });
  }
});
</script>

</body>
</html>
